# [정책서] 온보딩 및 초기 진입 플로우

## 1. 개요

이 문서는 신규 방문자가 서비스에 처음 진입할 때 경험하는 온보딩 과정과 익명(게스트) 계정 생성 정책을 정의합니다.

## 2. 온보딩 진입 조건

### 2.1 대상 사용자

- **신규 방문자**: 브라우저에 접속 기록(LocalStorage)이 없는 사용자.
- **기존 방문자 (초기화 됨)**: 브라우저 캐시를 삭제한 사용자.

### 2.2 진입 판단 로직

1. `localStorage`의 `brute-force-onboarding-completed` 플래그 확인.
2. 플래그가 없으면 온보딩 대상(New Visitor)으로 판단.
3. 플래그가 있으면 온보딩 생략(Returning Visitor).

> [!NOTE]
> 온보딩 모달이 표시되는 **즉시** `brute-force-onboarding-completed` 플래그를 `true`로 설정합니다. 이는 사용자가 새로고침하더라도 온보딩이 불필요하게 반복되지 않도록 하기 위함입니다.

## 3. 사용자 시나리오 (User Flow)

### 3.1 온보딩 모달 (Onboarding Modal)

- **표시**: 전체 화면 오버레이(Modal) 형태로 게임 화면 위에 표시됩니다.
- **구성**: 게임의 핵심 규칙을 설명하는 슬라이드 (비밀번호 해독, 실시간 피드, CP 시스템 등).
- **액션**:
  - **Play as Guest (완료)**: 익명 계정을 생성하고 게임에 즉시 입장합니다.
  - **Close (닫기)**: 온보딩을 중단하고 모달을 닫습니다. 계정을 생성하지 않습니다.

### 3.2 인증 요구 블록 (Authentication Required Block)

- **표시**: 사용자가 **로그인하지 않은 상태**일 때, 해킹 콘솔(Hacking Console) 자리에 대신 표시됩니다.
- **발생 조건**:
  - 온보딩 모달을 닫았을 때 (계정 미생성 상태).
  - 로그아웃 했을 때.
- **기능**:
  - **[Play as Guest] 버튼**: 클릭 시 익명 계정을 생성하고 로그인합니다. (온보딩 완료와 동일 효과)
  - **[Sign In] 버튼**: 기존 계정으로 로그인하기 위한 모달을 띄웁니다.
  - **[Join the Game] 링크**: 회원가입 페이지로 이동합니다.

## 4. 익명 계정 생성 정책

### 4.1 생성 시점 (Explicit Trigger)

과거의 '접속 시 자동 생성' 방식은 폐기되었습니다. 반드시 사용자의 **명시적 액션**이 있어야 게스트 계정이 생성됩니다.

- **Case A**: 온보딩 모달의 "Play as Guest" 버튼 클릭.
- **Case B**: 인증 요구 블록의 "Play as Guest" 버튼 클릭.

### 4.2 자원 지급

- 신규 익명 계정 생성 시 **5 CP**가 초기 자원으로 지급됩니다. (DB Migration `20260122000000` 적용)

## 5. 예외 처리

### 5.1 새로고침 (Refresh)

- 온보딩 도중 새로고침 시:
  - 이미 플래그가 설정되었으므로 온보딩 모달은 뜨지 않습니다.
  - 계정이 생성되지 않았으므로 **인증 요구 블록**이 표시됩니다.
  - 사용자는 "Play as Guest"를 눌러 게임을 시작할 수 있습니다.

### 5.2 로그아웃

- 로그아웃 시:
  - 세션이 종료되고 `user` 상태가 `null`이 됩니다.
  - 해킹 콘솔이 사라지고 **인증 요구 블록**이 표시됩니다.
  - 재로그인하거나 다시 게스트로 플레이할 수 있습니다.
