# [시스템 정책서] Brute Force AI: 무결성 및 예외 관리

## 1. 글로벌 블록 및 해킹 정책

### 1.1 동시 정답 처리 (Race Condition)

- 상황: 전 세계의 유저 두 명 이상이 동일한 찰나(ms 단위)에 정답을 제출한 경우.
- 정책:
  - 서버에 **먼저 도착한 요청(Atomic Transaction)**을 최종 승자로 판정합니다.
  - 0.1초 차이로 늦게 제출된 유저에게는 "이미 다른 유저가 블록을 해독했습니다"라는 알림과 함께 소모된 CP를 즉시 반환합니다.

### 1.2 유효하지 않은 입력값 처리

- 상황: 난이도 규칙(예: 9자리 정확히)에 어긋나는 값(예: 5자리 또는 10자리)을 제출한 경우.
- 정책:
  - 클라이언트: 입력 단계에서 정확한 자릿수만 입력 가능하도록 제한하고, 자릿수가 맞지 않으면 전송을 차단합니다.
  - 서버: API 호출 시 규칙을 재검증하며, 규칙 위반 시 CP를 차감하지 않고 에러 코드(400 Bad Request)를 반환합니다.
  - 비밀번호 자릿수는 범위가 아닌 정확한 고정값으로 설정됩니다 (예: "9자리"로 명시, "6~12자리" 범위 없음).

## 2. 승리자 및 시드 힌트 예외 정책

### 2.1 승리자 타임아웃 (180초 규칙)

- 상황: 승자가 정답을 맞힌 후 힌트 입력 화면에서 180초 동안 아무런 액션을 취하지 않는 경우.
- 정책:
  - 자동 전환: 180초 경과 즉시 승자의 입력 권한을 박탈하고 시스템(Gemini AI)이 '기본 테마'를 바탕으로 암호를 자동 생성하여 다음 블록을 시작합니다.
  - 기록 유지: 해당 블록의 승리자 이름은 유지되지만, 힌트 칸에는 "System Generated"로 기록됩니다.

### 2.2 승리자 중도 이탈

- 상황: 승자가 힌트를 입력하기 전 브라우저를 종료하거나 네트워크 연결이 끊긴 경우.
- 정책:
  - 서버는 승자의 세션이 끊김을 감지하더라도 180초 대기 시간을 유지합니다. (재접속 기회 부여)
  - 시간 내 미접속 시 2.1 정책(자동 전환)을 따릅니다.

### 2.3 부적절한 힌트 입력

- 상황: 승자가 욕설, 비하 발언, 또는 암호 정답 자체를 힌트로 입력하는 경우.
- 정책:
  - AI 필터링: 승자가 입력한 힌트는 Gemini API를 통해 1차 검증을 거칩니다.
  - 반려: 부적절하다고 판단될 경우 승자에게 재입력을 요청하며, 이때 타임아웃 시간(180초)은 멈추지 않습니다. 계속 반려되어 시간이 초과되면 시스템 자동 생성으로 넘어갑니다.

## 3. 컴퓨팅 파워(CP) 및 자원 정책

### 3.1 CP 동기화 오류

- 상황: 클라이언트 로컬 시간 조작이나 네트워크 지연으로 인해 서버와 클라이언트의 CP 수치가 다른 경우.
- 정책:
  - 모든 CP 소모 및 충전의 최종 결정권은 서버에 있습니다.
  - 클라이언트는 주기적으로 서버의 CP 값을 Fetch하여 보정하며, 서버 값과 다를 경우 서버 값을 우선으로 덮어씁니다.

### 3.2 부정 응답 반복 (Abuse 방지)

- 상황: 특정 계정이나 IP에서 비정상적으로 빠른 속도로 오답을 제출하는 경우.
- 정책:
  - Rate Limit: CP 소모와 별개로 초당 요청 횟수를 제한합니다. (예: 초당 2회 이상 요청 시 10초간 잠금)
  - 매크로 감지: 일정한 패턴으로 오답을 시도하는 경우 캡차(CAPTCHA) 인증을 강제합니다.

## 4. 시스템 및 AI 운영 정책

### 4.1 AI 암호 생성 실패

- 상황: AI 서버 점검이나 API 할당량 초과로 인해 새로운 암호를 생성할 수 없는 경우.
- 정책:
  - Fallback 암호: 시스템 내부에 미리 정의된 '백업 암호 리스트'에서 하나를 무작위로 추출하여 블록을 생성합니다.
  - 공지: 유저에게 "현재 AI 모듈 점검 중으로 시스템 표준 암호가 적용됩니다"라는 시스템 메시지를 노출합니다.

### 4.2 블록 강제 종료 및 초기화

- 상황: 암호 생성 알고리즘의 오류로 정답 해독이 불가능한 수준의 난이도가 발생하여 게임이 고착된 경우.
- 정책:
  - 시스템 개입: 특정 블록의 총 시도 횟수가 예상 범위의 500%를 초과하면 AI 코치가 '결정적 힌트'를 자동으로 투척합니다.
  - 관리자 강제 종료: 필요시 관리자가 해당 블록을 무효화하고 새로운 블록을 강제 시작할 수 있습니다. (이 경우 참여 유저들의 소모된 CP를 보상함)

## 5. 기록 및 보상 정책

### 5.1 블록 기록의 영구화 (Immutability)

- 상황: 블록이 완료된 후 승자 정보나 정답을 수정하고 싶은 경우.
- 정책:
  - 해결된 블록의 원장(Ledger)은 수정이 불가능합니다. 단, 승리자 닉네임이 운영 정책(부적절한 이름 등)에 위반될 경우 관리자가 해당 텍스트만 '운영자에 의해 삭제됨'으로 마스킹 처리할 수 있습니다.

## 6. 사용자 인증 정책

### 6.1 계정 유형

- 상황: 게임에 참여하기 위해 접속한 사용자.
- 정책:
  - **게스트(익명) 로그인**: 별도의 가입 없이 즉시 게임 플레이가 가능합니다. 단, 브라우저 캐시 삭제 시 데이터가 소실될 수 있습니다.
  - **이메일 회원가입**: 계정 영구 보존, 랭킹 등록, 보상 수령을 위해서는 이메일 가입이 필요합니다.
  - 닉네임은 회원가입 시 필수로 입력하며, 2~20자 사이여야 합니다.

### 6.2 어뷰징 방지 (Abuse Prevention)

- 상황: 브라우저 스토리지 초기화 등을 통해 반복적으로 신규 계정(게스트)을 생성하여 무한 CP를 획득하려는 시도.
- 정책:
  - **Device Fingerprinting**: 클라이언트의 기기 고유 식별값(Visitor ID)을 수집하여 동일 기기에서의 과도한 계정 생성을 감지합니다.
  - **제재**: 어뷰징 패턴(예: 짧은 시간 내 다수의 계정 생성)이 감지될 경우, 해당 기기에서의 신규 익명 계정 생성을 일시적으로 차단하거나 CP 지급을 제한할 수 있습니다.
